<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è Admin Dashboard - Jobletters.xyz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        /* Admin-specific styles */
        :root {
            --primary: #0047ab;
            --accent: #ffd700;
            --bg-color: #f7f9fc;
            --card-bg: white;
            --danger: #dc3545;
            --success: #28a745;
        }
        body { font-family: 'Montserrat', sans-serif; margin: 0; background-color: var(--bg-color); color: #333; }
        .container { max-width: 1100px; margin: 40px auto 80px; padding: 30px; border-radius: 12px; }
        h1 { color: var(--primary); margin-bottom: 30px; text-align: center; }
        
        /* Metrics Grid */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .metric-card { background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        .metric-card h3 { margin: 0 0 10px 0; font-size: 1em; color: #555; }
        .metric-card p { font-size: 1.8em; font-weight: 700; color: var(--primary); margin: 0; }
        .metric-card .icon { float: right; font-size: 3em; color: var(--accent); opacity: 0.6; }

        /* Sections */
        .admin-section { background: var(--card-bg); padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .admin-section h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--primary); }
        
        /* Forms */
        input[type="text"], input[type="number"], input[type="password"], select { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        label { font-weight: 600; margin-top: 10px; display: block; }
        button { background-color: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600; transition: background-color 0.3s; margin-top: 10px; }
        button.danger { background-color: var(--danger); }
        button.primary { background-color: var(--primary); }
        button:hover { opacity: 0.9; }

        /* Table */
        .user-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .user-table th, .user-table td { border: 1px solid #ddd; padding: 12px; text-align: left; font-size: 0.9em; }
        .user-table th { background-color: #f2f2f2; color: var(--primary); }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-screwdriver-wrench"></i> Admin Dashboard</h1>
        <p style="text-align: center; color: var(--danger);">NOTE: This is a client-side mock-up. All data is stored in your browser's local storage and is not truly secure or persistent.</p>

        <div class="dashboard-grid">
            <div class="metric-card">
                <i class="icon fas fa-chart-line"></i>
                <h3>Total Income (NGN)</h3>
                <p id="totalIncome">‚Ç¶0</p>
            </div>
            <div class="metric-card">
                <i class="icon fas fa-file-pdf"></i>
                <h3>PDF Downloads</h3>
                <p id="pdfDownloads">0</p>
            </div>
            <div class="metric-card">
                <i class="icon fas fa-robot"></i>
                <h3>AI Generations</h3>
                <p id="aiGenerations">0</p>
            </div>
            <div class="metric-card">
                <i class="icon fas fa-envelope"></i>
                <h3>Emails Sent (Mock)</h3>
                <p id="emailsSent">0</p>
            </div>
        </div>

        <div class="admin-section">
            <h2><i class="fas fa-cogs"></i> Global Settings & AI Configuration</h2>
            
            <label for="documentPrice">Document Download Price (NGN)</label>
            <input type="number" id="documentPrice" value="500" min="100">
            <button onclick="updatePrice()" class="primary"><i class="fas fa-dollar-sign"></i> Update Price</button>
            
            <label for="defaultAiProvider">Default AI Provider</label>
            <select id="defaultAiProvider">
                <option value="openai">OpenAI (GPT-4 Turbo)</option>
                <option value="anthropic">Anthropic (Claude 3.5)</option>
                <option value="google">Google (Gemini Pro)</option>
            </select>
            <button onclick="updateProvider()" class="primary"><i class="fas fa-robot"></i> Update Default Provider</button>
            
            <label for="aiApiKey">Master AI API Key</label>
            <input type="password" id="aiApiKey" placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxx">
            <p style="font-size: 0.8em; color: #555; margin-top: 5px;">This key is used by the server (mocked) for all AI generations.</p>
            <button onclick="updateApiKey()" class="danger"><i class="fas fa-key"></i> Update API Key</button>
        </div>

        <div class="admin-section">
            <h2><i class="fas fa-user-gear"></i> User & Transaction Data</h2>
            <p style="margin-top: 0;">Below shows a mock list of user transactions and emails.</p>
            <table class="user-table" id="transactionTable">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
            <button onclick="clearAllData()" class="danger" style="margin-top: 25px;"><i class="fas fa-trash-alt"></i> Clear All Mock Metrics & Settings</button>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="/index.html"><i class="fas fa-home"></i> Back to Homepage</a>
        </div>
    </div>
    
    <script>
        const STORAGE_PREFIX = 'jobletters_';
        
        // MOCK TRANSACTION DATA STRUCTURE
        let mockTransactions = JSON.parse(localStorage.getItem(STORAGE_PREFIX + 'transactions') || '[]');
        
        function loadDashboard() {
            // Load Metrics
            document.getElementById('totalIncome').textContent = '‚Ç¶' + (parseInt(localStorage.getItem(STORAGE_PREFIX + 'income') || '0')).toLocaleString();
            document.getElementById('pdfDownloads').textContent = (parseInt(localStorage.getItem(STORAGE_PREFIX + 'downloads') || '0')).toLocaleString();
            document.getElementById('aiGenerations').textContent = (parseInt(localStorage.getItem(STORAGE_PREFIX + 'generations') || '0')).toLocaleString();
            document.getElementById('emailsSent').textContent = (parseInt(localStorage.getItem(STORAGE_PREFIX + 'emails') || '0')).toLocaleString();

            // Load Settings
            document.getElementById('documentPrice').value = localStorage.getItem(STORAGE_PREFIX + 'price')?.replace('‚Ç¶', '') || '500';
            document.getElementById('defaultAiProvider').value = localStorage.getItem(STORAGE_PREFIX + 'provider') || 'openai';
            document.getElementById('aiApiKey').value = localStorage.getItem(STORAGE_PREFIX + 'api_key') || '';


            // Populate Transactions Table (Mock)
            const tableBody = document.getElementById('transactionTable').querySelector('tbody');
            tableBody.innerHTML = ''; 
            
            // Sort to show newest first
            const sortedTx = mockTransactions.slice().sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedTx.forEach(tx => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = tx.email;
                row.insertCell().textContent = tx.type;
                row.insertCell().textContent = '‚Ç¶' + tx.amount;
                row.insertCell().textContent = tx.status;
                row.insertCell().textContent = new Date(tx.date).toLocaleDateString();
            });
        }
        
        // --- Admin Functions (Mock) ---
        function updateApiKey() {
            const newKey = document.getElementById('aiApiKey').value.trim();
            if (newKey.length < 10) {
                 alert("Please enter a valid-looking API key.");
                 return;
            }
            localStorage.setItem(STORAGE_PREFIX + 'api_key', newKey);
            alert("‚úÖ Master API Key updated. All future AI calls will use this key (mocked).");
            loadDashboard();
        }

        function updatePrice() {
            const newPrice = document.getElementById('documentPrice').value.trim();
            if (parseInt(newPrice) < 100) {
                 alert("Price must be at least NGN 100.");
                 return;
            }
            localStorage.setItem(STORAGE_PREFIX + 'price', `‚Ç¶${newPrice}`);
            alert(`‚úÖ Document price updated to ‚Ç¶${newPrice}. (Frontend price updated)`);
            loadDashboard();
        }
        
        function updateProvider() {
            const newProvider = document.getElementById('defaultAiProvider').value;
            localStorage.setItem(STORAGE_PREFIX + 'provider', newProvider);
            alert(`‚úÖ Default AI Provider set to ${newProvider}. (Mocked setting)`);
            loadDashboard();
        }
        
        function clearAllData() {
             if (confirm("DANGER: Are you sure you want to clear ALL mock metrics and settings? This is irreversible.")) {
                 Object.keys(localStorage).forEach(key => {
                     if (key.startsWith(STORAGE_PREFIX)) {
                         localStorage.removeItem(key);
                     }
                 });
                 // Re-initialize mock transactions (if you want default data back)
                 mockTransactions = [];
                 localStorage.setItem(STORAGE_PREFIX + 'transactions', '[]');
                 alert("üõë All mock data cleared.");
                 window.location.reload();
             }
        }

        // Check Access on Load
        if (localStorage.getItem(STORAGE_PREFIX + 'admin_access') !== 'granted') {
            document.body.innerHTML = '<div class="container" style="text-align: center;"><h1>Access Denied</h1><p>You must enter the secret code on the homepage (Ctrl+Shift+A) to access this dashboard.</p><a href="/index.html">Go Home</a></div>';
        } else {
            // Mock transaction data initialization (if empty, populate with some defaults)
            if (mockTransactions.length === 0) {
                 mockTransactions = [
                    { email: 'admin@jobletters.xyz', type: 'SETUP', amount: 0, status: 'N/A', date: new Date().toISOString() },
                    { email: 'user1@example.com', type: 'RESUME', amount: 500, status: 'Paid', date: new Date(Date.now() - 3600000).toISOString() },
                    { email: 'user2@example.com', type: 'COVERLETTER', amount: 500, status: 'Paid', date: new Date(Date.now() - 7200000).toISOString() },
                    { email: 'user3@example.com', type: 'RESIGNATION', amount: 500, status: 'Failed', date: new Date(Date.now() - 10800000).toISOString() }
                ];
                 localStorage.setItem(STORAGE_PREFIX + 'transactions', JSON.stringify(mockTransactions));
            }
            // Mock default metrics if they don't exist
             if (!localStorage.getItem(STORAGE_PREFIX + 'downloads')) localStorage.setItem(STORAGE_PREFIX + 'downloads', '20');
             if (!localStorage.getItem(STORAGE_PREFIX + 'generations')) localStorage.setItem(STORAGE_PREFIX + 'generations', '50');
             if (!localStorage.getItem(STORAGE_PREFIX + 'income')) localStorage.setItem(STORAGE_PREFIX + 'income', '10000');
             if (!localStorage.getItem(STORAGE_PREFIX + 'emails')) localStorage.setItem(STORAGE_PREFIX + 'emails', '10');


            loadDashboard();
        }
    </script>
</body>
</html>
